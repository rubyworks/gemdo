#!/usr/bin/env ruby

require 'pom'
require 'optparse'

project = POM::Project.new

if ARGV.empty?

  require 'rubygems'

  text = STDIN.read.strip

  if /^---/ =~ text
    obj = YAML.load(text)
  else
    obj = text
  end

  case obj
  when Gem::Specification
    project = POM::Project.from_gemspec(obj)
    project.metadata.save
  else
    project = POM::Project.from_readme(obj)
p project
  end

else

  case ARGV.first
  when 'about'
    project.metadata.load
    puts project.about
  when 'show'
    project.metadata.load
    puts project.metadata.send(ARGV.last)
  when 'dump'
    project.metadata.load
    puts project.metadata.to_yaml
  when 'gemspec'
    File.open(project.metadata.name + '.gemspec', 'w') do |f|
      f << project.to_gemspec.to_yaml
    end
  else
    puts "unknown command -- #{ARGV.first}"
  end

end

